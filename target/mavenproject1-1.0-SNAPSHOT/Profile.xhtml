
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="jakarta.faces.html"
      xmlns:f="jakarta.faces.core"
      xmlns:p="http://primefaces.org/ui"
      xmlns:ui="jakarta.faces.facelets">

<h:head>
    <title>Your Account - Logic Pharmacy</title>
    <style>
        body { background:#f4f6f9; font-family: Arial; }
        .profile-box {
            background:white; width:500px; margin:40px auto;
            padding:25px; border-radius:10px;
            box-shadow:0 2px 10px rgba(0,0,0,0.1);
        }
        h2 { text-align:center; margin-bottom:20px; color:#01756e; }
        table { width:100%; font-size:16px; }
        td { padding:10px 0; }
        .back-link {
            display:block; margin-bottom:15px; font-size:15px;
            color:#01756e; text-decoration:none;
        }
        .back-link:hover { text-decoration:underline; }
        .order-box {
            background:#eef7ff; padding:12px;
            border-left:4px solid #01756e;
            border-radius:6px; margin-bottom:10px;
        }
        .status-badge {
    padding:4px 10px;
    border-radius: 6px;
    font-size: 13px;
    font-weight: bold;
    color:white;
    display:inline-block;
}
.status-pending { background:#ff9800; }
.status-processing { background:#2196f3; }
.status-shipped { background:#673ab7; }
.status-delivered { background:#4caf50; }
.status-cancelled { background:#f44336; }

    </style>
</h:head>

<h:body>

    <div class="profile-box">

        <a href="index.xhtml" class="back-link">&#8592; BACK TO HOME</a>

        <h2>Your Profile</h2>

        <table>
            <tr><td><b>Username:</b></td><td>#{loginBean.loggedUser.username}</td></tr>
            <tr><td><b>Email:</b></td><td>#{loginBean.loggedUser.email}</td></tr>
            <tr><td><b>Phone:</b></td><td>#{loginBean.loggedUser.phone}</td></tr>
        </table>

        <br/><hr/><br/>

        <!-- YOUR ADDRESSES -->
        <h3 style="color:#01756e;">Your Addresses</h3>

        <h:panelGroup id="profileAddressList">
            <h:panelGroup rendered="#{empty customerBean.userAddresses}">
                <div style="color:#888;">No addresses added yet.</div>
            </h:panelGroup>

            <ui:repeat value="#{customerBean.userAddresses}" var="addr">
                <div style="background:#eef7f6; padding:12px; margin-bottom:10px;
                            border-radius:6px; border-left:4px solid #01756e;">
                    <b>#{addr.addressLine}</b><br/>
                    #{addr.city}, #{addr.state} - #{addr.pincode}
                </div>
            </ui:repeat>
        </h:panelGroup>

        <br/><hr/><br/>

        <!-- =======================
             SHOW USER ORDERS
        ======================== -->
        <h3 style="color:#01756e;">Your Orders</h3>
<!-- =======================
     SHOW USER ORDERS
======================== -->
<!--<h3 style="color:#01756e;">Your Orders</h3>-->

<h:panelGroup id="orderList">

    <!-- If no orders -->
    <h:panelGroup rendered="#{empty orderBean.orderList}">
        <div style="color:#888;">You have not placed any orders yet.</div>
    </h:panelGroup>

    <!-- Show orders -->
    <ui:repeat value="#{orderBean.orderList}" var="o">

        <div class="order-box">
            <b>Order ID:</b> #{o.orderId}<br/>
            <b>Date:</b> #{o.orderDate}<br/>
            <!--<b>Status:</b> #{o.status}<br/>-->
            <b>Status:</b>
<span class="status-badge
      #{o.status.toLowerCase() eq 'pending' ? 'status-pending' : ''}
      #{o.status.toLowerCase() eq 'processing' ? 'status-processing' : ''}
      #{o.status.toLowerCase() eq 'shipped' ? 'status-shipped' : ''}
      #{o.status.toLowerCase() eq 'delivered' ? 'status-delivered' : ''}
      #{o.status.toLowerCase() eq 'cancelled' ? 'status-cancelled' : ''}">
    #{o.status}
</span>
            <!-- CANCEL ORDER BUTTON (Only when status = Placed) -->
<h:panelGroup rendered="#{o.status eq 'Placed' or o.status eq 'Pending' or o.status eq 'Processing'}">
    <h:form>
        <p:commandButton value="Cancel Order"
                         action="#{orderBean.cancelOrder(o.orderId)}"
                         update="orderList"
                         style="background:#f44336;color:white;" />
    </h:form>
</h:panelGroup>


<br/><br/>

            <b>Total Amount:</b> ₹#{o.totalAmount}<br/><br/>

            <!-- Order Items Table -->
            <table style="width:100%; font-size:14px; background:white; border-radius:6px;">
                <tr style="background:#d5eaff; font-weight:bold;">
                    <td>Medicine</td>
                    <td>Qty</td>
                    <td>Price</td>
                </tr>

                <ui:repeat value="#{o.orderItemsCollection}" var="item">
                    <tr>
                        <td>#{item.medicineId.name}</td>
                        <td>#{item.quantity}</td>
                        <td>₹#{item.price}</td>
                    </tr>
                </ui:repeat>
            </table>
<p:commandButton value="Download Receipt"
                 icon="pi pi-download"
                 ajax="false"
                 style="background:#01756e;color:white;"
                 onclick="window.location.href='ReceiptServlet?orderId=#{o.orderId}'"/>

        </div>

    </ui:repeat>

</h:panelGroup>

        <br/><br/>

        <!-- LOGOUT -->
        <h:form>
            <h:commandLink action="#{loginBean.logout}" style="color:#c00;">
                <i class="pi pi-sign-out"></i> Logout
            </h:commandLink>
        </h:form>

    </div>
</h:body>
</html>
